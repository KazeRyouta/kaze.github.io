<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Kesehatan Prioritas</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet" />
    <style>
  /* Reset & base */
  *, *::before, *::after {
    box-sizing: border-box;
  }
  body {
    margin:0;
    font-family: 'Inter', sans-serif;
    background-color: #f6f9fc;
    color: #1a1a1a;
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  a {
    color: inherit;
    text-decoration: none;
  }
  img {
    max-width: 100%;
    display: block;
  }

  /* Container */
  .container {
    width: 90%;
    max-width: 1280px;
    margin: 0 auto;
  }

  /* Header */
  header {
    background: #1fa39a;
    padding: 16px 0;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
  }

  .header-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .logo {
    font-weight: 700;
    font-size: 1.5rem;
    color: #ffffff;
    letter-spacing: 2px;
  }

  nav.desktop-nav {
    display: flex;
    gap: 24px;
  }

  nav.desktop-nav a {
    color: #ffffff;
    font-weight: 600;
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 8px 12px;
    border-radius: 8px;
    transition: background-color 0.3s ease;
  }
  nav.desktop-nav a:hover,
  nav.desktop-nav a:focus {
    background-color: #13504a;
  }

  button.cta-btn,
  button#adminMenuBtn {
    background-color: #06927e;
    color: #fff;
    border: none;
    border-radius: 12px;
    padding: 10px 20px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button.cta-btn:hover,
  button.cta-btn:focus,
  button#adminMenuBtn:hover,
  button#adminMenuBtn:focus {
    background-color: #047062;
  }

  /* New button for Pemesanan */
  button#orderMenuBtn {
    background-color: #068c7d;
    color: #fff;
    border: none;
    border-radius: 12px;
    padding: 10px 20px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
    display: none;
  }
  button#orderMenuBtn:hover,
  button#orderMenuBtn:focus {
    background-color: #046953;
  }

  /* Mobile menu toggle */
  .mobile-menu-btn {
    display: none;
    background: none;
    border: none;
    color: #fff;
    font-size: 32px;
    cursor: pointer;
  }

  /* Mobile nav */
  nav.mobile-nav {
    display: none;
    flex-direction: column;
    background: #1fa39a;
    padding: 12px 24px;
  }
  nav.mobile-nav a {
    padding: 12px 0;
    border-bottom: 1px solid rgba(255 255 255 / 0.3);
    color: #ffffff;
    font-weight: 600;
  }
  nav.mobile-nav a:last-child {
    border-bottom: none;
  }

  /* Hero section */
  .hero {
    background: linear-gradient(135deg, #1fa39a, #3bc1b5);
    color: #fff;
    padding: 64px 24px 88px;
    text-align: center;
  }
  .hero h1 {
    font-size: 2.75rem;
    font-weight: 700;
    margin-bottom: 20px;
    max-width: 480px;
    margin-left: auto;
    margin-right: auto;
    line-height: 1.1;
  }
  .hero p.subtitle {
    font-weight: 600;
    font-size: 1.125rem;
    opacity: 0.85;
    margin-bottom: 40px;
  }
  .hero .btn-group {
    display: inline-flex;
    gap: 16px;
    flex-wrap: wrap;
    justify-content: center;
  }
  .hero button.btn-outline {
    color: #fff;
    background: transparent;
    border: 2.5px solid #fff;
    border-radius: 36px;
    font-weight: 600;
    padding: 12px 28px;
    cursor: pointer;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  .hero button.btn-outline:hover,
  .hero button.btn-outline:focus {
    background: #fff;
    color: #1fa39a;
  }
  .hero button.btn-primary {
    background:#fff;
    color:#1fa39a;
    border: none;
    border-radius: 36px;
    font-weight: 600;
    padding: 12px 28px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .hero button.btn-primary:hover,
  .hero button.btn-primary:focus {
    background:#c7f0ec;
  }

  /* Section titles */
  h2.section-title {
    font-weight: 700;
    font-size: 2rem;
    text-align: center;
    margin: 64px 0 44px;
    color: #233742;
  }

  /* Cards grid */
  .cards-grid {
    display: grid;
    gap: 24px;
    padding: 0 12px;
  }
  /* 3 column desktop, 1 column mobile */
  @media (min-width: 768px) {
    .cards-grid {
      grid-template-columns: repeat(3, 1fr);
      padding: 0;
      gap: 32px;
      max-width: 1240px;
      margin: 0 auto;
    }
  }

  .card {
    background: #e0f2ef;
    border-radius: 20px;
    padding: 36px 24px;
    box-shadow: 0 4px 12px rgb(0 0 0 / 0.07);
    color: #1b4440;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  .card .material-icons {
    font-size: 48px;
    color: #2a7f77;
    margin-bottom: 20px;
  }

  .card h3 {
    font-weight: 700;
    font-size: 1.25rem;
    margin-bottom: 12px;
  }
  .card p {
    font-size: 1rem;
    line-height: 1.4;
    max-width: 280px;
    margin: 0 auto;
  }

  /* Produk Kesehatan Search Section */
  .product-search-section {
    background: linear-gradient(135deg, #1fa39a, #3bc1b5);
    border-radius: 20px;
    margin: 80px 20px;
    padding: 48px 20px 56px;
    color: #ffffff;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
  }

  .product-search-section p {
    flex: 1 0 100%;
    font-weight: 600;
    font-size: 1.25rem;
    text-align: center;
    margin-bottom: 24px;
  }

  .product-search-section .search-bar {
    display: flex;
    width: 100%;
    max-width: 660px;
    gap: 12px;
  }

  .product-search-section input[type="text"] {
    flex-grow: 1;
    padding: 12px 24px;
    font-weight: 600;
    border-radius: 36px;
    border: none;
    font-size: 1rem;
  }
  .product-search-section button.search-btn {
    padding: 12px 32px;
    background: #ffffff;
    border: none;
    font-weight: 700;
    border-radius: 36px;
    cursor: pointer;
    color: #1fa39a;
    font-size: 1rem;
    transition: background-color 0.3s ease;
  }
  .product-search-section button.search-btn:hover,
  .product-search-section button.search-btn:focus {
    background: #c7f0ec;
  }

  /* Product cards section */
  .product-list-section {
    max-width: 1280px;
    margin: 40px auto 80px;
    padding: 0 16px;
  }

  .product-list {
    display: grid;
    gap: 24px;
  }
  /* Responsive 3-column desktop, 1-column mobile */
  @media (min-width: 768px){
    .product-list {
      grid-template-columns: repeat(3, 1fr);
      padding: 0;
    }
  }
  .product-card {
    border-radius: 16px;
    overflow: hidden;
    background: white;
    box-shadow: 0 8px 20px rgb(0 0 0 / 0.07);
    display: flex;
    flex-direction: column;
    cursor: pointer;
    transition: transform 0.25s ease;
  }
  .product-card:hover,
  .product-card:focus {
    transform: translateY(-8px);
    box-shadow: 0 14px 32px rgb(0 0 0 / 0.12);
  }
  .product-image {
    width: 100%;
    height: 160px;
    object-fit: cover;
  }
  .product-info {
    padding: 16px 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .product-info h4 {
    font-weight: 700;
    font-size: 1.125rem;
    line-height: 1.2;
  }
  .product-info p {
    color: #555555;
    font-size: 0.95rem;
    line-height: 1.4;
  }
  .product-image-fallback {
    width: 100%;
    height: 160px;
    background: #10b981;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1rem;
  }

  /* Consultation section */
  .consultation-section {
    background: #1fa39a;
    color: #d0f1ec;
    padding: 48px 24px;
    border-radius: 0 0 20px 20px;
    text-align: center;
  }
  .consultation-section h3 {
    font-weight: 700;
    font-size: 2rem;
    margin-bottom: 20px;
  }
  .consultation-section p {
    font-weight: 600;
    font-size: 1.125rem;
    margin-bottom: 32px;
  }
  .consultation-section button {
    background: #fff;
    padding: 14px 36px;
    border-radius: 36px;
    border: none;
    font-weight: 700;
    color: #1fa39a;
    cursor: pointer;
    font-size: 1.125rem;
    transition: background-color 0.3s ease;
  }
  .consultation-section button:hover,
  .consultation-section button:focus {
    background: #c7f0ec;
  }

  /* Footer */
  footer {
    background-color: #0e382f;
    color: #a0d9d0;
    padding: 36px 24px;
  }
  footer .container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }
  footer small {
    font-size: 0.875rem;
  }

  /* Responsive Header and navigation */
  @media (max-width: 767px) {
    nav.desktop-nav {
      display: none;
    }
    .mobile-menu-btn {
      display: block;
    }
    nav.mobile-nav.show {
      display: flex;
    }
    .hero h1 {
      font-size: 2rem;
    }
    .cards-grid {
      grid-template-columns: 1fr;
      gap: 28px;
    }
    .product-list {
      grid-template-columns: 1fr;
      gap: 24px;
    }
    .product-search-section {
      margin: 48px 0 40px;
      border-radius: 0;
      padding: 32px 16px 48px;
    }
    .product-search-section p {
      font-size: 1.125rem;
    }
  }

  /* Wide Desktop layout max width */
  @media (min-width: 1440px) {
    .container {
      max-width: 1440px;
    }
  }

  /* Modal overlay */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.35);
    backdrop-filter: blur(4px);
    z-index: 2000;
    justify-content: center;
    align-items: center;
    overflow-y: auto;
    padding: 16px;
  }

  .modal-overlay.active {
    display: flex;
  }

  /* Modal container */
  .modal {
    background: #ffffff;
    border-radius: 20px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    width: 90%;
    max-width: 600px;
    padding: 32px 28px;
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 24px;
    max-height: 90vh;
    overflow-y: auto;
  }

  /* Total price text style for order form */
  .total-price-display {
    font-weight: 700;
    font-size: 1.125rem;
    color: #1fa39a;
    text-align: right;
    margin-top: -12px;
    margin-bottom: 12px;
    user-select: none;
  }

  .modal h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1fa39a;
    text-align: center;
    margin: 0;
  }

  .modal button {
    padding: 12px 0;
    font-size: 1.125rem;
    font-weight: 700;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .modal .btn-secondary {
    background: transparent;
    border: 2.5px solid #1fa39a;
    color: #1fa39a;
  }
  .modal .btn-secondary:hover,
  .modal .btn-secondary:focus {
    background: #1fa39a;
    color: #ffffff;
  }

  .modal .btn-primary {
    background: #1fa39a;
    color: #fff;
  }
  .modal .btn-primary:hover,
  .modal .btn-primary:focus {
    background: #14786d;
  }

  .modal .close-btn {
    position: absolute;
    top: 16px;
    right: 16px;
    background: transparent;
    border: none;
    font-size: 28px;
    line-height: 1;
    color: #333;
    cursor: pointer;
    transition: color 0.3s ease;
  }
  .modal .close-btn:hover,
  .modal .close-btn:focus {
    color: #1fa39a;
  }

  .modal form {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .modal label {
    font-weight: 600;
    font-size: 1rem;
    color: #333;
  }

  .modal input[type="text"],
  .modal input[type="email"],
  .modal input[type="password"],
  .modal textarea,
  .modal input[type="tel"],
  .modal input[type="number"],
  .modal select {
    padding: 12px 16px;
    font-size: 1rem;
    border: 1.8px solid #ccc;
    border-radius: 12px;
    resize: vertical;
  }
  .modal input[type="text"]:focus,
  .modal input[type="email"]:focus,
  .modal input[type="password"]:focus,
  .modal textarea:focus,
  .modal input[type="tel"]:focus,
  .modal input[type="number"]:focus,
  .modal select:focus {
    outline: none;
    border-color: #1fa39a;
    box-shadow: 0 0 6px #1fa39a;
  }

  .modal .error-message {
    color: #e03e2f;
    font-weight: 700;
    font-size: 0.875rem;
    text-align: center;
  }
  /* Added success message style */
  .modal .success-message {
    color: #2a7f77;
    font-weight: 700;
    font-size: 1rem;
    text-align: center;
  }
  
  /* Admin Dashboard Modal */
  #adminDashboardModal .modal {
    max-width: 900px;
  }
  #adminDashboardModal .admin-options {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
    gap: 20px;
    margin-top: 20px;
  }
  #adminDashboardModal .admin-option {
    background: #1fa39a;
    color: white;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    box-shadow: 0 4px 10px rgb(0 0 0 / 0.12);
  }
  #adminDashboardModal .admin-option:hover,
  #adminDashboardModal .admin-option:focus {
    background-color: #14786d;
    outline: none;
  }
  #adminDashboardModal .admin-option .material-icons {
    font-size: 36px;
    margin-bottom: 12px;
  }
  #adminDashboardModal .admin-option span {
    font-weight: 700;
    font-size: 1rem;
    text-align: center;
  }

  /* Responsive Admin Dashboard Modal */
  @media (max-width: 480px) {
    #adminDashboardModal .admin-options {
      grid-template-columns: 1fr;
    }
  }

  /* Style for status update button in today's orders */
  .order-status-btn {
    cursor: pointer;
    background-color: #1fa39a;
    border: none;
    border-radius: 12px;
    color: white;
    font-weight: 700;
    padding: 6px 14px;
    font-size: 0.9rem;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    transition: background-color 0.3s ease;
  }
  .order-status-btn:hover,
  .order-status-btn:focus {
    background-color: #14786d;
    outline: none;
  }
  /* Disabled style for delivered status */
  .order-status-btn[disabled] {
    background-color: #ccc;
    color: #666;
    cursor: default;
  }
  .status-icon {
    font-size: 18px;
  }

  /* Stock and image edit container for product stock modal */
  .product-stock-item {
    border-bottom: 1px solid #ccc;
    padding: 12px 0;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
  }
  .stock-info {
    flex: 1 1 130px;
    min-width: 130px;
  }
  .stock-input {
    width: 70px;
    padding: 8px 10px;
    font-size: 1rem;
    border-radius: 8px;
    border: 1.5px solid #ccc;
    text-align: right;
  }
  .image-url-input {
    flex: 1 1 300px;
    min-width: 280px;
    padding: 8px 10px;
    font-size: 1rem;
    border-radius: 8px;
    border: 1.5px solid #ccc;
  }
  .save-stock-btn {
    background-color: #1fa39a;
    border: none;
    color: white;
    font-weight: 700;
    border-radius: 12px;
    padding: 10px 20px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .save-stock-btn:hover,
  .save-stock-btn:focus {
    background-color: #14786d;
    outline: none;
  }
  .product-stock-item label {
    font-weight: 600;
    font-size: 0.9rem;
    display: block;
    margin-bottom: 4px;
  }
  .product-img-preview {
    width: 60px;
    height: 60px;
    border-radius: 8px;
    object-fit: cover;
    border: 1.5px solid #ccc;
    background-color: #f0f0f0;
    flex-shrink: 0;
  }
  </style>
  </head>
  <body>
    <!-- Header -->
    <header>
      <div class="container header-inner">
        <div class="logo" tabindex="0">KesehatanPrioritas</div>
        <nav class="desktop-nav" aria-label="Primary Navigation">
          <a href="#" tabindex="0"><span class="material-icons"
              aria-hidden="true">medical_services</span> Layanan</a>
          <a href="#" tabindex="0"><span class="material-icons"
              aria-hidden="true">local_hospital</span> Produk</a>
          <a href="#" tabindex="0"><span class="material-icons"
              aria-hidden="true">forum</span> Konsultasi</a>
        </nav>
        <button class="cta-btn" type="button" tabindex="0" id="openLoginModal">Masuk</button>
        <button id="adminMenuBtn" type="button" tabindex="0" aria-label="Menu Admin" style="display:none;">Admin</button>
        <button id="orderMenuBtn" type="button" tabindex="0" aria-label="Menu Pemesanan Obat">Pemesanan</button>
        <button class="mobile-menu-btn" aria-label="Toggle menu"
          aria-expanded="false">&#9776;</button>
      </div>
      <nav class="mobile-nav" aria-label="Mobile Navigation">
        <a href="#" tabindex="0"><span class="material-icons"
            aria-hidden="true">medical_services</span> Layanan</a>
        <a href="#" tabindex="0"><span class="material-icons"
            aria-hidden="true">local_hospital</span> Produk</a>
        <a href="#" tabindex="0"><span class="material-icons"
            aria-hidden="true">forum</span> Konsultasi</a>
        <a href="#" tabindex="0" class="cta-btn"
          style="margin-top:16px; text-align:center; background:#06927e; color:#fff; border-radius: 12px;" id="mobileLoginBtn">Masuk</a>
      </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero" aria-label="Hero section dengan prioritas kesehatan">
      <h1 tabindex="0">Kesehatanmu Prioritas Bagi Kami</h1>
      <p class="subtitle" tabindex="0">Konsultasi Gratis - Cek Ketersediaan
        obat</p>
      <div class="btn-group">
        <button class="btn-outline" type="button" tabindex="0">Konsultasi
          Gratis</button>
        <button class="btn-primary" type="button" tabindex="0">Cek Ketersediaan
          obat</button>
      </div>
    </section>

    <!-- Layanan Utama -->
    <h2 class="section-title" tabindex="0">Layanan Utama Kami</h2>
    <section class="cards-grid" aria-label="Layanan utama">
      <article class="card" tabindex="0" role="group"
        aria-labelledby="layanan1-title">
        <span class="material-icons" aria-hidden="true">local_pharmacy</span>
        <h3 id="layanan1-title">Pelayanan Apotek</h3>
        <p>Layanan apotik dengan obat lengkap dan konsultasi ahli untuk
          kebutuhan Anda.</p>
      </article>
      <article class="card" tabindex="0" role="group"
        aria-labelledby="layanan2-title">
        <span class="material-icons" aria-hidden="true">medical_services</span>
        <h3 id="layanan2-title">Konsultasi Medis</h3>
        <p>Konsultasi dengan dokter ahli melalui platform mudah dan aman.</p>
      </article>
      <article class="card" tabindex="0" role="group"
        aria-labelledby="layanan3-title">
        <span class="material-icons" aria-hidden="true">local_hospital</span>
        <h3 id="layanan3-title">Pengiriman Obat Cepat</h3>
        <p>Pengiriman ke rumah Anda dengan sistem yang cepat dan terpercaya.</p>
      </article>
    </section>

    <!-- Produk Kesehatan Search -->
    <section class="product-search-section"
      aria-label="Cari Produk Kesehatan Terlaris">
      <p tabindex="0">Produk Kesehatan Terlaris</p>
      <form class="search-bar" role="search" aria-label="Cari produk kesehatan">
        <input type="text" aria-label="Masukkan nama produk kesehatan"
          placeholder="Cari produk..." />
        <button type="submit" class="search-btn"
          aria-label="Tombol cari produk kesehatan">Cari</button>
      </form>
    </section>

    <!-- Produk Kesehatan Terlaris -->
    <section class="product-list-section"
      aria-label="Produk Kesehatan Terlaris">
      <h2 class="section-title" tabindex="0">Produk Kesehatan Terlaris</h2>
      <div class="product-list" id="productListContainer">
        <!-- Produk akan di-render secara dinamis -->
      </div>
    </section>

    <!-- Konsultasi Section -->
    <section class="consultation-section" aria-label="Bagian konsultasi">
      <h3 tabindex="0">Butuh Konsultasi? Silahkan kontak kami, Kami Siap
        Membantu</h3>
      <p tabindex="0">Layanan konsultasi gratis untuk kesehatan Anda.</p>
      <button type="button" tabindex="0">Hubungi Kami</button>
    </section>

    <!-- Footer -->
    <footer>
      <div class="container">
        <p>KesehatanPrioritas &copy; 2024. All rights reserved.</p>
        <small>Kontak: info@kesehatanprioritas.id | Telp: +62 21 1234
          5678</small>
      </div>
    </footer>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="loginModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" tabindex="-1">
      <!-- Step 1: Role Selection -->
      <div class="modal" id="modalStep1">
        <button class="close-btn" aria-label="Close modal" id="closeModalBtn">&times;</button>
        <h2 id="modalTitle">Masuk Sebagai</h2>
        <button type="button" class="btn-primary" id="btnPelanggan">Pelanggan</button>
        <button type="button" class="btn-secondary" id="btnAdmin">Admin</button>
      </div>
      <!-- Step 2: Pelanggan Menu -->
      <div class="modal" id="modalStep2" style="display:none;">
        <button class="close-btn" aria-label="Kembali ke pilihan" id="backToStep1From2">&larr;</button>
        <h2>Masuk Pelanggan</h2>
        <button type="button" class="btn-primary" id="btnRegistrasi">Registrasi</button>
        <button type="button" class="btn-secondary" id="btnLoginPelanggan">Login Pelanggan</button>
      </div>
      <!-- Step 3: Admin Login -->
      <div class="modal" id="modalStep3" style="display:none;">
        <button class="close-btn" aria-label="Kembali ke pilihan" id="backToStep1From3">&larr;</button>
        <h2>Login Admin</h2>
        <form id="adminLoginForm" novalidate>
          <label for="adminUsername">Username</label>
          <input type="text" id="adminUsername" name="adminUsername" autocomplete="username" required />
          <label for="adminPassword">Password</label>
          <input type="password" id="adminPassword" name="adminPassword" autocomplete="current-password" required />
          <div class="error-message" id="adminLoginError" role="alert" aria-live="assertive"></div>
          <button type="submit" class="btn-primary">Login</button>
        </form>
      </div>
      <!-- Step 4: Pelanggan Registrasi Form -->
      <div class="modal" id="modalStep4" style="display:none;">
        <button class="close-btn" aria-label="Kembali ke pilihan" id="backToStep2From4">&larr;</button>
        <h2>Form Registrasi Pelanggan</h2>
        <form id="customerRegistrationForm" novalidate>
          <label for="regName">Nama Lengkap</label>
          <input type="text" id="regName" name="regName" autocomplete="name" required />
          <label for="regAddress">Alamat</label>
          <textarea id="regAddress" name="regAddress" rows="3" required></textarea>
          <label for="regEmail">Email</label>
          <input type="email" id="regEmail" name="regEmail" autocomplete="email" required />
          <label for="regPhone">No. HP</label>
          <input type="tel" id="regPhone" name="regPhone" autocomplete="tel" pattern="\\d{10,15}" required />
          <div class="error-message" id="registrationError" role="alert" aria-live="assertive"></div>
          <div class="success-message" id="registrationSuccess" aria-live="polite"></div>
          <button type="submit" class="btn-primary">Daftar</button>
        </form>
      </div>
      <!-- Step 5: Pelanggan Login Form -->
      <div class="modal" id="modalStep5" style="display:none;">
        <button class="close-btn" aria-label="Kembali ke pilihan" id="backToStep2From5">&larr;</button>
        <h2>Login Pelanggan</h2>
        <form id="customerLoginForm" novalidate>
          <label for="loginEmail">Email</label>
          <input type="email" id="loginEmail" name="loginEmail" autocomplete="email" required />
          <label for="loginPhone">No. HP</label>
          <input type="tel" id="loginPhone" name="loginPhone" autocomplete="tel" pattern="\\d{10,15}" required />
          <div class="error-message" id="loginError" role="alert" aria-live="assertive"></div>
          <button type="submit" class="btn-primary">Login</button>
        </form>
      </div>
    </div>

    <!-- Modal Overlay for Pemesanan -->
    <div class="modal-overlay" id="orderModal" role="dialog" aria-modal="true" aria-labelledby="orderModalTitle" tabindex="-1">
      <div class="modal" id="orderModalContent">
        <button class="close-btn" aria-label="Close pemesanan form" id="closeOrderModalBtn">&times;</button>
        <h2 id="orderModalTitle">Form Pemesanan Obat</h2>
        <form id="orderForm" novalidate>
          <label for="medicineName">Nama Obat</label>
          <input type="text" id="medicineName" name="medicineName" required autocomplete="off" list="medicineList" aria-describedby="medicineHelp" />
          <datalist id="medicineList">
            <!-- Dynamic product names options -->
          </datalist>
          <div id="medicineHelp" style="font-size:0.875rem; color:#555; margin-bottom: 12px;">
            Pilih nama obat yang tersedia sesuai daftar.
          </div>
          <label for="quantity">Jumlah</label>
          <input type="number" id="quantity" name="quantity" min="1" required aria-describedby="quantityHelp" />
          <div id="totalPrice" class="total-price-display" aria-live="polite" aria-atomic="true">Total Harga: Rp 0</div>
          <label for="deliveryAddress">Alamat Pengiriman</label>
          <textarea id="deliveryAddress" name="deliveryAddress" rows="3" required></textarea>
          <label for="contactPhone">No. HP Kontak</label>
          <input type="tel" id="contactPhone" name="contactPhone" pattern="\\d{10,15}" required />
          <div class="error-message" id="orderError" role="alert" aria-live="assertive"></div>
          <div class="success-message" id="orderSuccess" aria-live="polite"></div>
          <button type="submit" class="btn-primary">Submit Pesanan</button>
        </form>
      </div>
    </div>

    <!-- Admin Dashboard Modal -->
    <div class="modal-overlay" id="adminDashboardModal" role="dialog" aria-modal="true" aria-labelledby="adminDashboardTitle" tabindex="-1">
      <div class="modal" role="document" aria-label="Dashboard Admin">
        <button class="close-btn" aria-label="Tutup dashboard admin" id="closeAdminDashboardBtn">&times;</button>
        <h2 id="adminDashboardTitle">Dashboard Admin</h2>
        <div class="admin-options">
          <button class="admin-option" tabindex="0" id="btnAddProduct" aria-label="Tambah produk baru">
            <span class="material-icons" aria-hidden="true">add_box</span>
            <span>Tambah produk baru</span>
          </button>
          <button class="admin-option" tabindex="0" id="btnTodayOrders" aria-label="Pesanan masuk hari ini">
            <span class="material-icons" aria-hidden="true">today</span>
            <span>Pesanan masuk hari ini</span>
          </button>
          <button class="admin-option" tabindex="0" id="btnProductStock" aria-label="Stok produk & Kelola Gambar">
            <span class="material-icons" aria-hidden="true">inventory_2</span>
            <span>Stok produk & Kelola Gambar</span>
          </button>
          <button class="admin-option" tabindex="0" id="btnTotalCustomers" aria-label="Total pelanggan">
            <span class="material-icons" aria-hidden="true">groups</span>
            <span>Total pelanggan</span>
          </button>
          <button class="admin-option" tabindex="0" id="btnMonthlyIncome" aria-label="Penghasilan bulan ini">
            <span class="material-icons" aria-hidden="true">paid</span>
            <span>Penghasilan bulan ini</span>
          </button>
          <button class="admin-option" tabindex="0" id="btnPrescriptionVerification" aria-label="Verifikasi resep">
            <span class="material-icons" aria-hidden="true">assignment_turned_in</span>
            <span>Verifikasi resep</span>
          </button>
          <button class="admin-option" tabindex="0" id="btnViewSalesReport" aria-label="Lihat laporan penjualan">
            <span class="material-icons" aria-hidden="true">bar_chart</span>
            <span>Lihat laporan penjualan</span>
          </button>
          <button class="admin-option" tabindex="0" id="btnManageUsers" aria-label="Kelola pengguna">
            <span class="material-icons" aria-hidden="true">manage_accounts</span>
            <span>Kelola pengguna</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Modal: Tambah Produk Baru -->
    <div class="modal-overlay" id="addProductModal" role="dialog" aria-modal="true" aria-labelledby="addProductTitle" tabindex="-1">
      <div class="modal">
        <button class="close-btn" aria-label="Tutup modal tambah produk" id="closeAddProductModal">&times;</button>
        <h2 id="addProductTitle">Tambah Produk Baru</h2>
        <form id="addProductForm">
          <label for="newProductName">Nama Produk</label>
          <input type="text" id="newProductName" name="newProductName" required />
          <label for="newProductPrice">Harga Produk (Rp)</label>
          <input type="number" id="newProductPrice" name="newProductPrice" min="0" required />
          <label for="newProductStock">Stok Produk</label>
          <input type="number" id="newProductStock" name="newProductStock" min="0" required />
          <div class="error-message" id="productAddError"></div>
          <div class="success-message" id="productAddSuccess"></div>
          <button type="submit" class="btn-primary">Tambahkan Produk</button>
        </form>
      </div>
    </div>

    <!-- Modal: Pesanan Masuk Hari Ini -->
    <div class="modal-overlay" id="todayOrdersModal" role="dialog" aria-modal="true" aria-labelledby="todayOrdersTitle" tabindex="-1">
      <div class="modal">
        <button class="close-btn" aria-label="Tutup modal pesanan hari ini" id="closeTodayOrdersModal">&times;</button>
        <h2 id="todayOrdersTitle">Pesanan Masuk Hari Ini</h2>
        <div id="todayOrdersContent" style="max-height:60vh; overflow-y:auto;"></div>
      </div>
    </div>

    <!-- Modal: Stok Produk & Kelola Gambar -->
    <div class="modal-overlay" id="productStockModal" role="dialog" aria-modal="true" aria-labelledby="productStockTitle" tabindex="-1">
      <div class="modal">
        <button class="close-btn" aria-label="Tutup modal stok produk" id="closeProductStockModal">&times;</button>
        <h2 id="productStockTitle">Stok Produk & Kelola Gambar</h2>
        <div id="productStockContent" style="max-height:60vh; overflow-y:auto;"></div>
      </div>
    </div>

    <!-- Modal: Total Pelanggan -->
    <div class="modal-overlay" id="totalCustomersModal" role="dialog" aria-modal="true" aria-labelledby="totalCustomersTitle" tabindex="-1">
      <div class="modal">
        <button class="close-btn" aria-label="Tutup modal total pelanggan" id="closeTotalCustomersModal">&times;</button>
        <h2 id="totalCustomersTitle">Total Pelanggan Terdaftar</h2>
        <div id="totalCustomersContent"></div>
      </div>
    </div>

    <!-- Modal: Penghasilan Bulan Ini -->
    <div class="modal-overlay" id="monthlyIncomeModal" role="dialog" aria-modal="true" aria-labelledby="monthlyIncomeTitle" tabindex="-1">
      <div class="modal">
        <button class="close-btn" aria-label="Tutup modal penghasilan bulan ini" id="closeMonthlyIncomeModal">&times;</button>
        <h2 id="monthlyIncomeTitle">Penghasilan Bulan Ini</h2>
        <div id="monthlyIncomeContent"></div>
      </div>
    </div>

    <!-- Modal: Verifikasi Resep -->
    <div class="modal-overlay" id="prescriptionVerificationModal" role="dialog" aria-modal="true" aria-labelledby="prescriptionVerificationTitle" tabindex="-1">
      <div class="modal">
        <button class="close-btn" aria-label="Tutup modal verifikasi resep" id="closePrescriptionVerificationModal">&times;</button>
        <h2 id="prescriptionVerificationTitle">Verifikasi Resep Obat</h2>
        <form id="prescriptionForm">
          <label for="prescriptionName">Nama Pasien</label>
          <input type="text" id="prescriptionName" name="prescriptionName" required />
          <label for="prescriptionDetails">Detail Resep (Nama Obat, Dosis, Keterangan)</label>
          <textarea id="prescriptionDetails" name="prescriptionDetails" rows="4" required></textarea>
          <div class="error-message" id="prescriptionError"></div>
          <div class="success-message" id="prescriptionSuccess"></div>
          <button type="submit" class="btn-primary">Masukkan Resep</button>
        </form>
      </div>
    </div>

    <!-- Modal: Lihat Laporan Penjualan -->
    <div class="modal-overlay" id="salesReportModal" role="dialog" aria-modal="true" aria-labelledby="salesReportTitle" tabindex="-1">
      <div class="modal">
        <button class="close-btn" aria-label="Tutup modal laporan penjualan" id="closeSalesReportModal">&times;</button>
        <h2 id="salesReportTitle">Laporan Penjualan Obat</h2>
        <div id="salesReportContent" style="max-height:60vh; overflow-y:auto;"></div>
      </div>
    </div>

    <!-- Modal: Kelola Pengguna -->
    <div class="modal-overlay" id="manageUsersModal" role="dialog" aria-modal="true" aria-labelledby="manageUsersTitle" tabindex="-1">
      <div class="modal">
        <button class="close-btn" aria-label="Tutup modal kelola pengguna" id="closeManageUsersModal">&times;</button>
        <h2 id="manageUsersTitle">Kelola Pengguna Aktif</h2>
        <div id="manageUsersContent" style="max-height:60vh; overflow-y:auto;"></div>
      </div>
    </div>

    <script>
    // Mobile menu toggle
    const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
    const mobileNav = document.querySelector('nav.mobile-nav');
    mobileMenuBtn.addEventListener('click', () => {
      const expanded = mobileMenuBtn.getAttribute('aria-expanded') === 'true' || false;
      mobileMenuBtn.setAttribute('aria-expanded', !expanded);
      mobileNav.classList.toggle('show');
    });

    // Modal and login flow logic
    const loginModal = document.getElementById('loginModal');
    const openLoginModalBtn = document.getElementById('openLoginModal');
    const closeModalBtn = document.getElementById('closeModalBtn');

    // Modal steps
    const modalStep1 = document.getElementById('modalStep1');
    const modalStep2 = document.getElementById('modalStep2');
    const modalStep3 = document.getElementById('modalStep3');
    const modalStep4 = document.getElementById('modalStep4'); // Registrasi Pelanggan
    const modalStep5 = document.getElementById('modalStep5'); // Login Pelanggan

    // Buttons
    const btnPelanggan = document.getElementById('btnPelanggan');
    const btnAdmin = document.getElementById('btnAdmin');
    const backToStep1From2 = document.getElementById('backToStep1From2');
    const backToStep1From3 = document.getElementById('backToStep1From3');
    const backToStep2From4 = document.getElementById('backToStep2From4');
    const backToStep2From5 = document.getElementById('backToStep2From5');

    const btnRegistrasi = document.getElementById('btnRegistrasi');
    const btnLoginPelanggan = document.getElementById('btnLoginPelanggan');

    // Forms
    const adminLoginForm = document.getElementById('adminLoginForm');
    const customerRegistrationForm = document.getElementById('customerRegistrationForm');
    const customerLoginForm = document.getElementById('customerLoginForm');

    // Admin form inputs and error display
    const adminUsernameInput = document.getElementById('adminUsername');
    const adminPasswordInput = document.getElementById('adminPassword');
    const adminLoginError = document.getElementById('adminLoginError');

    // Customer registration error/success display
    const registrationError = document.getElementById('registrationError');
    const registrationSuccess = document.getElementById('registrationSuccess');

    // Customer login error display
    const loginError = document.getElementById('loginError');

    // Order Menu Button & Order Modal
    const orderMenuBtn = document.getElementById('orderMenuBtn');
    const orderModal = document.getElementById('orderModal');
    const closeOrderModalBtn = document.getElementById('closeOrderModalBtn');
    const orderForm = document.getElementById('orderForm');
    const orderError = document.getElementById('orderError');
    const orderSuccess = document.getElementById('orderSuccess');

    // Admin Menu Button & Admin Dashboard Modal
    const adminMenuBtn = document.getElementById('adminMenuBtn');
    const adminDashboardModal = document.getElementById('adminDashboardModal');
    const closeAdminDashboardBtn = document.getElementById('closeAdminDashboardBtn');

    // Mobile login button (inside mobile nav)
    const mobileLoginBtn = document.getElementById('mobileLoginBtn');

    // Open login modal, show step 1
    openLoginModalBtn.addEventListener('click', () => {
      loginModal.classList.add('active');
      showStep(1);
      loginModal.focus();
    });
    mobileLoginBtn.addEventListener('click', () => {
      loginModal.classList.add('active');
      showStep(1);
      mobileNav.classList.remove('show');
      mobileMenuBtn.setAttribute('aria-expanded', 'false');
      loginModal.focus();
    });

    // Close login modal function
    function closeModal() {
      loginModal.classList.remove('active');
      clearAdminForm();
      clearCustomerRegForm();
      clearCustomerLoginForm();
    }
    closeModalBtn.addEventListener('click', closeModal);

    // Close on overlay click only if clicked outside modal steps
    loginModal.addEventListener('click', (e) => {
      if (e.target === loginModal) {
        closeModal();
      }
    });

    // Close login modal on ESC key
    document.addEventListener('keydown', (e) => {
      if(e.key === 'Escape' && loginModal.classList.contains('active')) {
        closeModal();
      }
      if(e.key === 'Escape' && orderModal.classList.contains('active')) {
        closeOrderModal();
      }
      if(e.key === 'Escape' && adminDashboardModal.classList.contains('active')) {
        closeAdminDashboard();
      }
      // Close other modals on ESC
      closeModalIfOpen('addProductModal', e);
      closeModalIfOpen('todayOrdersModal', e);
      closeModalIfOpen('productStockModal', e);
      closeModalIfOpen('totalCustomersModal', e);
      closeModalIfOpen('monthlyIncomeModal', e);
      closeModalIfOpen('prescriptionVerificationModal', e);
      closeModalIfOpen('salesReportModal', e);
      closeModalIfOpen('manageUsersModal', e);
    });

    function closeModalIfOpen(modalId, event) {
      const modal = document.getElementById(modalId);
      if(modal && modal.classList.contains('active') && event.key === 'Escape'){
        modal.classList.remove('active');
      }
    }

    // Show modal step
    function showStep(step) {
      modalStep1.style.display = 'none';
      modalStep2.style.display = 'none';
      modalStep3.style.display = 'none';
      modalStep4.style.display = 'none';
      modalStep5.style.display = 'none';

      if (step === 1) modalStep1.style.display = 'flex';
      else if (step === 2) modalStep2.style.display = 'flex';
      else if (step === 3) modalStep3.style.display = 'flex';
      else if (step === 4) modalStep4.style.display = 'flex';
      else if (step === 5) modalStep5.style.display = 'flex';
    }

    // Navigation buttons
    btnPelanggan.addEventListener('click', () => {
      showStep(2);
    });
    btnAdmin.addEventListener('click', () => {
      showStep(3);
    });
    backToStep1From2.addEventListener('click', () => {
      showStep(1);
    });
    backToStep1From3.addEventListener('click', () => {
      showStep(1);
      clearAdminForm();
    });
    backToStep2From4.addEventListener('click', () => {
      showStep(2);
      clearCustomerRegForm();
    });
    backToStep2From5.addEventListener('click', () => {
      showStep(2);
      clearCustomerLoginForm();
    });

    // Registrasi and login pelanggan buttons
    btnRegistrasi.addEventListener('click', () => {
      showStep(4);
      clearCustomerRegForm();
    });
    btnLoginPelanggan.addEventListener('click', () => {
      showStep(5);
      clearCustomerLoginForm();
    });

    // Admin login validation
    adminLoginForm.addEventListener('submit', (event) => {
      event.preventDefault();
      const username = adminUsernameInput.value.trim();
      const password = adminPasswordInput.value;
      if (username === 'Kaze' && password === 'admin123') {
        adminLoginError.textContent = '';
        alert('Login admin berhasil!');
        closeModal();
        switchToAdminMenu();
      } else {
        adminLoginError.textContent = 'Username atau password salah.';
        adminUsernameInput.focus();
      }
    });

    // Customer registration form submission
    customerRegistrationForm.addEventListener('submit', (event) => {
      event.preventDefault();
      registrationError.textContent = '';
      registrationSuccess.textContent = '';

      const name = document.getElementById('regName').value.trim();
      const address = document.getElementById('regAddress').value.trim();
      const email = document.getElementById('regEmail').value.trim().toLowerCase();
      const phone = document.getElementById('regPhone').value.trim();

      if (!name || !address || !email || !phone) {
        registrationError.textContent = 'Semua field harus diisi.';
        return;
      }
      // Basic email format validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        registrationError.textContent = 'Format email tidak valid.';
        return;
      }
      // Phone number numeric and length validation
      const phoneRegex = /^\d{10,15}$/;
      if (!phoneRegex.test(phone)) {
        registrationError.textContent = 'No. HP harus berisi 10-15 digit angka.';
        return;
      }

      // Retrieve current users from localStorage or init
      let customers = JSON.parse(localStorage.getItem('registeredCustomers')) || [];
      // Check if email already registered
      const exists = customers.some(user => user.email === email);
      if (exists) {
        registrationError.textContent = 'Email sudah terdaftar. Silakan login.';
        return;
      }

      // Add new customer
      const newCustomer = {
        id: Date.now(),
        name,
        address,
        email,
        phone,
        createdAt: new Date().toISOString(),
        active: true
      };
      customers.push(newCustomer);
      localStorage.setItem('registeredCustomers', JSON.stringify(customers));

      registrationSuccess.textContent = 'Registrasi berhasil! Silakan login.';
      customerRegistrationForm.reset();

      // After short delay, automatically redirect to login form
      setTimeout(() => {
        showStep(5);
        registrationSuccess.textContent = '';
      }, 1800);
    });

    function clearCustomerRegForm() {
      customerRegistrationForm.reset();
      registrationError.textContent = '';
      registrationSuccess.textContent = '';
    }

    // Customer login form submission
    customerLoginForm.addEventListener('submit', (event) => {
      event.preventDefault();
      loginError.textContent = '';

      const email = document.getElementById('loginEmail').value.trim().toLowerCase();
      const phone = document.getElementById('loginPhone').value.trim();

      if (!email || !phone) {
        loginError.textContent = 'Email dan No. HP harus diisi.';
        return;
      }
      const phoneRegex = /^\d{10,15}$/;
      if (!phoneRegex.test(phone)) {
        loginError.textContent = 'No. HP harus berisi 10-15 digit angka.';
        return;
      }

      let customers = JSON.parse(localStorage.getItem('registeredCustomers')) || [];
      const matchedUser = customers.find(user => user.email === email && user.phone === phone);
      if (matchedUser) {
        loginError.textContent = '';
        alert(`Login pelanggan berhasil! Selamat datang, ${matchedUser.name}.`);
        closeModal();
        switchToOrderMenu();
      } else {
        loginError.textContent = 'Email atau No. HP tidak cocok dengan data pendaftaran.';
      }
    });

    function clearCustomerLoginForm() {
      customerLoginForm.reset();
      loginError.textContent = '';
    }

    function clearAdminForm() {
      adminLoginForm.reset();
      adminLoginError.textContent = '';
    }

    // Replace 'Masuk' button with 'Pemesanan' button after customer login success
    function switchToOrderMenu() {
      openLoginModalBtn.style.display = 'none';
      mobileLoginBtn.style.display = 'none';
      orderMenuBtn.style.display = 'inline-block';
    }

    // Replace 'Masuk' button with 'Admin' menu button after admin login success
    function switchToAdminMenu() {
      openLoginModalBtn.style.display = 'none';
      mobileLoginBtn.style.display = 'none';
      orderMenuBtn.style.display = 'inline-block';
      adminMenuBtn.style.display = 'inline-block';
    }

    // Order Modal open/close handlers
    orderMenuBtn.addEventListener('click', () => {
      orderModal.classList.add('active');
      orderModal.focus();
    });

    closeOrderModalBtn.addEventListener('click', closeOrderModal);

    function closeOrderModal() {
      orderModal.classList.remove('active');
      clearOrderForm();
    }

    orderModal.addEventListener('click', (e) => {
      if (e.target === orderModal) {
        closeOrderModal();
      }
    });

    // Render product names inside datalist for autocomplete
    const medicineNameInput = document.getElementById('medicineName');
    const medicineList = document.getElementById('medicineList');
    function populateMedicineList() {
      let products = JSON.parse(localStorage.getItem('products')) || [];
      if(products.length === 0){
        // default products
        products = [
          {id:1,name:'Paracetamol', price:5000, stock:50, imageUrl: ''},
          {id:2,name:'Vitamin C', price:15000, stock:30, imageUrl: ''},
          {id:3,name:'Amoxicillin', price:20000, stock:20, imageUrl: ''},
        ];
        localStorage.setItem('products', JSON.stringify(products));
      }
      medicineList.innerHTML = products.map(p => `<option value="${p.name}"></option>`).join('');
    }
    populateMedicineList();

    // Calculate and update total price display
    const quantityInput = document.getElementById('quantity');
    const totalPriceDisplay = document.getElementById('totalPrice');

    function updateTotalPrice() {
      const productName = medicineNameInput.value.trim();
      const quantity = parseInt(quantityInput.value) || 0;
      let products = JSON.parse(localStorage.getItem('products')) || [];
      const product = products.find(p=>p.name.toLowerCase() === productName.toLowerCase());

      if(product && quantity > 0){
        const total = product.price * quantity;
        totalPriceDisplay.textContent = `Total Harga: Rp ${total.toLocaleString('id-ID')}`;
      } else {
        totalPriceDisplay.textContent = 'Total Harga: Rp 0';
      }
    }

    medicineNameInput.addEventListener('input', updateTotalPrice);
    quantityInput.addEventListener('input', updateTotalPrice);

    // Order form submission handling with stock update and order recording
    orderForm.addEventListener('submit', (e) => {
      e.preventDefault();
      orderError.textContent = '';
      orderSuccess.textContent = '';

      const medicineName = medicineNameInput.value.trim();
      const quantity = parseInt(quantityInput.value);
      const deliveryAddress = document.getElementById('deliveryAddress').value.trim();
      const contactPhone = document.getElementById('contactPhone').value.trim();

      if (!medicineName || !quantity || !deliveryAddress || !contactPhone) {
        orderError.textContent = 'Semua field harus diisi dengan benar.';
        return;
      }
      if (quantity < 1) {
        orderError.textContent = 'Jumlah minimal 1.';
        return;
      }
      const phoneRegex = /^\d{10,15}$/;
      if (!phoneRegex.test(contactPhone)) {
        orderError.textContent = 'No. HP kontak harus berisi 10-15 digit angka.';
        return;
      }

      let products = JSON.parse(localStorage.getItem('products')) || [];
      let productIndex = products.findIndex(p=>p.name.toLowerCase() === medicineName.toLowerCase());
      if(productIndex === -1){
        orderError.textContent = 'Nama obat tidak ditemukan di database.';
        return;
      }

      if(products[productIndex].stock < quantity){
        orderError.textContent = `Stok obat tidak mencukupi. Stok tersedia: ${products[productIndex].stock}`;
        return;
      }

      // Deduct stock
      products[productIndex].stock -= quantity;
      localStorage.setItem('products', JSON.stringify(products));
      populateMedicineList(); // refresh datalist

      // Save order to 'orders' storage with date
      let orders = JSON.parse(localStorage.getItem('orders')) || [];
      let newOrder = {
        id: Date.now(),
        productName: products[productIndex].name,
        quantity,
        deliveryAddress,
        contactPhone,
        date: new Date().toISOString().slice(0,10), // yyyy-mm-dd
        status: 'Menunggu',
        createdAt: new Date().toISOString()
      };
      orders.push(newOrder);
      localStorage.setItem('orders', JSON.stringify(orders));

      orderSuccess.textContent = 'Pesanan berhasil dikirim! Terima kasih.';
      orderForm.reset();
      updateTotalPrice();

      // Close modal after short delay
      setTimeout(() => {
        closeOrderModal();
        orderSuccess.textContent = '';

        // Refresh admin reports if open
        if(adminDashboardModal.classList.contains('active')){
          renderTodayOrders();
          renderProductStock();
          renderMonthlyIncome();
          renderSalesReport();
        }
      }, 2500);
    });

    function clearOrderForm() {
      orderForm.reset();
      orderError.textContent = '';
      orderSuccess.textContent = '';
      updateTotalPrice();
    }

    // Admin Dashboard Modal handlers
    adminMenuBtn.addEventListener('click', () => {
      adminDashboardModal.classList.add('active');
      adminDashboardModal.focus();
      // Refresh admin info on open
      renderTodayOrders();
      renderProductStock();
      renderTotalCustomers();
      renderMonthlyIncome();
      renderSalesReport();
      renderManageUsers();
    });

    closeAdminDashboardBtn.addEventListener('click', closeAdminDashboard);

    function closeAdminDashboard() {
      adminDashboardModal.classList.remove('active');
    }

    adminDashboardModal.addEventListener('click', (e) => {
      if (e.target === adminDashboardModal) {
        closeAdminDashboard();
      }
    });

    // ========== ADMIN FEATURES IMPLEMENTATION ==========

    // Modal references for admin features
    const addProductModal = document.getElementById('addProductModal');
    const todayOrdersModal = document.getElementById('todayOrdersModal');
    const productStockModal = document.getElementById('productStockModal');
    const totalCustomersModal = document.getElementById('totalCustomersModal');
    const monthlyIncomeModal = document.getElementById('monthlyIncomeModal');
    const prescriptionVerificationModal = document.getElementById('prescriptionVerificationModal');
    const salesReportModal = document.getElementById('salesReportModal');
    const manageUsersModal = document.getElementById('manageUsersModal');

    // Open modals on dashboard option click
    document.getElementById('btnAddProduct').addEventListener('click', () => {
      productAddError.textContent = '';
      productAddSuccess.textContent = '';
      document.getElementById('addProductForm').reset();
      addProductModal.classList.add('active');
    });

    document.getElementById('btnTodayOrders').addEventListener('click', () => {
      renderTodayOrders();
      todayOrdersModal.classList.add('active');
    });
    document.getElementById('btnProductStock').addEventListener('click', () => {
      renderProductStock();
      productStockModal.classList.add('active');
    });
    document.getElementById('btnTotalCustomers').addEventListener('click', () => {
      renderTotalCustomers();
      totalCustomersModal.classList.add('active');
    });
    document.getElementById('btnMonthlyIncome').addEventListener('click', () => {
      renderMonthlyIncome();
      monthlyIncomeModal.classList.add('active');
    });
    document.getElementById('btnPrescriptionVerification').addEventListener('click', () => {
      prescriptionError.textContent = '';
      prescriptionSuccess.textContent = '';
      document.getElementById('prescriptionForm').reset();
      prescriptionVerificationModal.classList.add('active');
    });
    document.getElementById('btnViewSalesReport').addEventListener('click', () => {
      renderSalesReport();
      salesReportModal.classList.add('active');
    });
    document.getElementById('btnManageUsers').addEventListener('click', () => {
      renderManageUsers();
      manageUsersModal.classList.add('active');
    });

    // Close buttons for admin modals
    document.getElementById('closeAddProductModal').addEventListener('click', () => addProductModal.classList.remove('active'));
    document.getElementById('closeTodayOrdersModal').addEventListener('click', () => todayOrdersModal.classList.remove('active'));
    document.getElementById('closeProductStockModal').addEventListener('click', () => productStockModal.classList.remove('active'));
    document.getElementById('closeTotalCustomersModal').addEventListener('click', () => totalCustomersModal.classList.remove('active'));
    document.getElementById('closeMonthlyIncomeModal').addEventListener('click', () => monthlyIncomeModal.classList.remove('active'));
    document.getElementById('closePrescriptionVerificationModal').addEventListener('click', () => prescriptionVerificationModal.classList.remove('active'));
    document.getElementById('closeSalesReportModal').addEventListener('click', () => salesReportModal.classList.remove('active'));
    document.getElementById('closeManageUsersModal').addEventListener('click', () => manageUsersModal.classList.remove('active'));

    // Add Product Form Handler
    const addProductForm = document.getElementById('addProductForm');
    const productAddError = document.getElementById('productAddError');
    const productAddSuccess = document.getElementById('productAddSuccess');

    addProductForm.addEventListener('submit', (e) => {
      e.preventDefault();
      productAddError.textContent = '';
      productAddSuccess.textContent = '';
      const productName = document.getElementById('newProductName').value.trim();
      const productPrice = Number(document.getElementById('newProductPrice').value);
      const productStock = Number(document.getElementById('newProductStock').value);
      if(!productName || isNaN(productPrice) || isNaN(productStock) || productPrice < 0 || productStock < 0){
        productAddError.textContent = 'Mohon isi semua field dengan benar.';
        return;
      }

      // Ambil produk dari localStorage atau buat array baru
      let products = JSON.parse(localStorage.getItem('products')) || [];
      // Tambahkan produk baru dengan imageUrl default empty string
      products.push({
        id: Date.now(),
        name: productName,
        price: productPrice,
        stock: productStock,
        imageUrl: ''
      });
      // Simpan ke localStorage
      localStorage.setItem('products', JSON.stringify(products));
      productAddSuccess.textContent = 'Produk berhasil ditambahkan!';
      addProductForm.reset();
      populateMedicineList();
      renderProductList();
      renderProductStock();
    });

    // Render Produk Terlaris di halaman utama berdasarkan data localStorage
    const productListContainer = document.getElementById('productListContainer');
    function renderProductList(){
      let products = JSON.parse(localStorage.getItem('products')) || [];
      if(products.length === 0){
        // Set produk default kalau localStorage kosong
        products = [
          {id:1,name:'Paracetamol', price:5000, stock:50, imageUrl: ''},
          {id:2,name:'Vitamin C', price:15000, stock:30, imageUrl: ''},
          {id:3,name:'Amoxicillin', price:20000, stock:20, imageUrl: ''},
        ];
        localStorage.setItem('products', JSON.stringify(products));
      }
      productListContainer.innerHTML = products.map(product => {
        const imgSrc = product.imageUrl && product.imageUrl.trim() !== '' 
          ? product.imageUrl.trim()
          : `https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/0bfe1bd4-e1eb-4eb9-a7aa-40fbae927c87.png)}`;
        return `
        <article class="product-card" tabindex="0" role="group" aria-labelledby="prod${product.id}-title">
          <img class="product-image" src="${imgSrc}" alt="Gambar produk ${product.name}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"/>
          <div class="product-image-fallback" style="display:none;">Gambar tidak tersedia</div>
          <div class="product-info">
            <h4 id="prod${product.id}-title">${product.name}</h4>
            <p>Harga: Rp ${product.price.toLocaleString()} <br> Stok: ${product.stock}</p>
          </div>
        </article>`;
      }).join('');
    }
    renderProductList();

    // Render fungsi untuk Pesanan Masuk Hari Ini dengan status update button
    function renderTodayOrders(){
      const container = document.getElementById('todayOrdersContent');
      let orders = JSON.parse(localStorage.getItem('orders')) || [];

      // Filter pesanan hari ini berdasarkan tanggal
      const today = new Date().toISOString().slice(0,10); 
      const todayOrders = orders.filter(order => order.date === today);

      if(todayOrders.length === 0){
        container.innerHTML = '<p>Tidak ada pesanan masuk hari ini.</p>';
        return;
      }

      // Generate HTML for each order with status update button
      container.innerHTML = todayOrders.map(o => {
        // Determine if status is updateable
        const canUpdate = o.status === 'Menunggu';
        const statusLabel = o.status === 'Menunggu' ? 'Menunggu' : 'Terkirim';
        const statusIcon = o.status === 'Menunggu' ? 'hourglass_empty' : 'check_circle';

        // Button is disabled if status is Terkirim
        return `
          <div style="border-bottom:1px solid #ccc;padding:8px 0; display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between; gap:8px;">
            <div style="flex-grow:1; min-width:200px;">
              <strong>Order ID:</strong> ${o.id}<br>
              <strong>Produk:</strong> ${o.productName}<br>
              <strong>Jumlah:</strong> ${o.quantity}<br>
              <strong>Alamat Pengiriman:</strong> ${o.deliveryAddress}<br>
              <strong>No. HP Kontak:</strong> ${o.contactPhone}<br>
            </div>
            <div style="flex-shrink:0;">
              <button class="order-status-btn" aria-label="Ubah status pesanan ${o.id} dari ${statusLabel}" ${!canUpdate ? 'disabled' : ''} data-order-id="${o.id}">
                <span class="material-icons status-icon" aria-hidden="true">${statusIcon}</span>${statusLabel}
              </button>
            </div>
          </div>
        `;
      }).join('');

      // Attach event listeners for status update buttons
      const statusButtons = container.querySelectorAll('.order-status-btn');
      statusButtons.forEach(button => {
        button.addEventListener('click', () => {
          const orderId = button.getAttribute('data-order-id');
          updateOrderStatus(orderId);
        });
      });
    }

    // Function to update order status from "Menunggu" to "Terkirim"
    function updateOrderStatus(orderId){
      let orders = JSON.parse(localStorage.getItem('orders')) || [];
      const orderIndex = orders.findIndex(order => order.id.toString() === orderId);
      if(orderIndex === -1) return;

      if(orders[orderIndex].status === 'Menunggu'){
        orders[orderIndex].status = 'Terkirim';
        localStorage.setItem('orders', JSON.stringify(orders));
        alert(`Status pesanan ID ${orderId} telah diperbarui menjadi Terkirim.`);
        renderTodayOrders();
      }
    }

    // Render fungsi untuk Stok Produk & Kelola Gambar
    function renderProductStock(){
      const container = document.getElementById('productStockContent');
      let products = JSON.parse(localStorage.getItem('products')) || [];
      if(products.length === 0){
        container.innerHTML = '<p>Data produk kosong.</p>';
        return;
      }
      // Generate product stock + image edit UI
      container.innerHTML = products.map((p, idx) => `
        <div class="product-stock-item" data-product-id="${p.id}">
          <div class="stock-info">
            <label for="stockInput${idx}">Nama Produk: <strong>${p.name}</strong></label>
            <label for="stockInput${idx}">Stok Produk</label>
            <input type="number" id="stockInput${idx}" class="stock-input" min="0" value="${p.stock}" aria-label="Ubah stok produk ${p.name}" />
          </div>
          <div style="flex:1 1 320px;">
            <label for="imageInput${idx}">URL Gambar Produk</label>
            <input type="text" id="imageInput${idx}" class="image-url-input" value="${p.imageUrl || ''}" placeholder="Masukkan URL gambar produk" aria-label="Ubah URL gambar produk ${p.name}" />
          </div>
          <img class="product-img-preview" src="${p.imageUrl && p.imageUrl.trim() !== '' ? p.imageUrl.trim() : `https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/97da4ea8-952a-45b1-8c09-6670a83cfa95.png)}`}" alt="Pratinjau gambar produk ${p.name}" onerror="this.src='https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/0e98f15b-8adf-4799-8b2b-d6b140d980ab.png';" />
          <div>
            <button class="save-stock-btn" aria-label="Simpan stok dan gambar produk ${p.name}">Simpan</button>
          </div>
        </div>
      `).join('');

      // Attach save button handlers
      const saveButtons = container.querySelectorAll('.save-stock-btn');
      saveButtons.forEach(button => {
        button.addEventListener('click', (e) => {
          const containerDiv = e.target.closest('.product-stock-item');
          const productId = Number(containerDiv.getAttribute('data-product-id'));
          const stockInput = containerDiv.querySelector('.stock-input');
          const imageInput = containerDiv.querySelector('.image-url-input');
          const newStock = Number(stockInput.value);
          const newImageUrl = imageInput.value.trim();

          if(isNaN(newStock) || newStock < 0){
            alert('Stok harus berupa angka nol atau lebih.');
            stockInput.focus();
            return;
          }
          // Validate minimal for image URL - allow empty string
          // Could add more URL validation here if needed

          // Update products in localStorage
          let products = JSON.parse(localStorage.getItem('products')) || [];
          const prodIndex = products.findIndex(p=>p.id === productId);
          if(prodIndex === -1) return;

          products[prodIndex].stock = newStock;
          products[prodIndex].imageUrl = newImageUrl;

          localStorage.setItem('products', JSON.stringify(products));

          alert(`Stok dan gambar produk ${products[prodIndex].name} berhasil disimpan.`);

          // Refresh product stock and product list UI
          renderProductStock();
          renderProductList();
          populateMedicineList();
        });
      });
    }

    // Render fungsi untuk Total Pelanggan
    function renderTotalCustomers(){
      const container = document.getElementById('totalCustomersContent');
      const customers = JSON.parse(localStorage.getItem('registeredCustomers')) || [];
      container.innerHTML = `<p>Total pelanggan terdaftar: <strong>${customers.length}</strong></p>`;
    }

    // Render fungsi untuk Penghasilan Bulan Ini
    function renderMonthlyIncome(){
      const container = document.getElementById('monthlyIncomeContent');
      const orders = JSON.parse(localStorage.getItem('orders')) || [];
      const products = JSON.parse(localStorage.getItem('products')) || [];
      if(orders.length === 0){
        container.innerHTML = '<p>Tidak ada data pesanan.</p>';
        return;
      }
      // Hitung penghasilan berdasarkan pesanan bulan ini
      const now = new Date();
      const currentMonth = now.getMonth();
      const currentYear = now.getFullYear();

      let totalIncome = 0;
      let totalItemsSold = 0;

      orders.forEach(order => {
        const orderDate = new Date(order.date);
        if(orderDate.getMonth() === currentMonth && orderDate.getFullYear() === currentYear){
          const product = products.find(p => p.name === order.productName);
          if(product){
            totalIncome += product.price * order.quantity;
            totalItemsSold += order.quantity;
          }
        }
      });

      container.innerHTML = `
        <p>Total barang terjual bulan ini: <strong>${totalItemsSold}</strong></p>
        <p>Total penghasilan bulan ini: <strong>Rp ${totalIncome.toLocaleString()}</strong></p>
      `;
    }

    // Form Verifikasi Resep
    const prescriptionForm = document.getElementById('prescriptionForm');
    const prescriptionError = document.getElementById('prescriptionError');
    const prescriptionSuccess = document.getElementById('prescriptionSuccess');

    prescriptionForm.addEventListener('submit', (e) => {
      e.preventDefault();
      prescriptionError.textContent = '';
      prescriptionSuccess.textContent = '';

      const name = document.getElementById('prescriptionName').value.trim();
      const details = document.getElementById('prescriptionDetails').value.trim();

      if(!name || !details){
        prescriptionError.textContent = 'Semua field harus diisi.';
        return;
      }

      let prescriptions = JSON.parse(localStorage.getItem('prescriptions')) || [];
      prescriptions.push({
        id: Date.now(),
        patientName: name,
        details,
        dateAdded: new Date().toISOString()
      });
      localStorage.setItem('prescriptions', JSON.stringify(prescriptions));

      prescriptionSuccess.textContent = 'Resep berhasil dimasukkan.';
      prescriptionForm.reset();
    });

    // Render fungsi untuk Laporan Penjualan
    function renderSalesReport(){
      const container = document.getElementById('salesReportContent');
      const orders = JSON.parse(localStorage.getItem('orders')) || [];
      const products = JSON.parse(localStorage.getItem('products')) || [];

      if(orders.length === 0){
        container.innerHTML = '<p>Tidak ada data penjualan.</p>';
        return;
      }

      // Agregasi jualan per produk
      const salesMap = {};
      orders.forEach(order => {
        if(!salesMap[order.productName]){
          salesMap[order.productName] = { sold:0, revenue:0 };
        }
        const product = products.find(p => p.name === order.productName);
        if(product){
          salesMap[order.productName].sold += order.quantity;
          salesMap[order.productName].revenue += product.price * order.quantity;
        }
      });

      const report = Object.entries(salesMap).map(([productName, data]) => `
        <div style="border-bottom:1px solid #ccc; padding:8px 0;">
          <strong>Produk:</strong> ${productName}<br>
          <strong>Terjual:</strong> ${data.sold}<br>
          <strong>Pendapatan:</strong> Rp ${data.revenue.toLocaleString()}
        </div>
      `).join('');
      container.innerHTML = report || '<p>Tidak ada data penjualan.</p>';
    }

    // Render fungsi untuk Kelola Pengguna Aktif
    function renderManageUsers(){
      const container = document.getElementById('manageUsersContent');
      let customers = JSON.parse(localStorage.getItem('registeredCustomers')) || [];
      customers = customers.filter(customer => customer.active);
      if(customers.length === 0){
        container.innerHTML = '<p>Tidak ada pengguna aktif.</p>';
        return;
      }
      container.innerHTML = customers.map(c => `
        <div style="border-bottom:1px solid #ccc; padding:8px 0;">
          <strong>Nama:</strong> ${c.name}<br>
          <strong>Email:</strong> ${c.email}<br>
          <strong>No HP:</strong> ${c.phone}<br>
          <strong>Terdaftar:</strong> ${new Date(c.createdAt).toLocaleDateString()}<br>
          <strong>Status:</strong> Aktif
        </div>
      `).join('');
    }

    // CLOSE ADMIN MODAL ON OUTSIDE CLICK
    [addProductModal, todayOrdersModal, productStockModal, totalCustomersModal, monthlyIncomeModal, prescriptionVerificationModal, salesReportModal, manageUsersModal].forEach(modal=>{
      modal.addEventListener('click', e=>{
        if(e.target === modal) modal.classList.remove('active');
      });
    });

    </script>
  </body>
</html>
